@page
@model ListViewModel
@{
    //var employeeschema = (Razor.Training.Models.Employee)Activator.CreateInstance((Model.Employees.GetType().GetGenericArguments().Single()));
    var employeeschema = new Razor.Training.Models.Employee();
    var employees = Model.Employees;
    var positions = Model.Positions;

    var datalist = (from emp in employees
                    join pos in positions on emp.PositionId equals pos.Id into a
                    from b in a.DefaultIfEmpty(new Position())
                    select new { Eid = emp.Id, Empno = emp.Empno, Name = emp.Name, Sex = emp.Sex, EnterDate = emp.EnterDate, Email = emp.Email, Position = b.Name }).ToList();
}

@*<div>
    <p>TempData參數:@TempData["Text"]</p>
</div>*@
<form method="post" style="margin:1rem 0;">
    <div class="row">
        <div class="col-4">
            <div class="row">
                <div class="col">
                    <label asp-for="Search"></label>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <input class="form-control" asp-for="Search" />
                </div>
            </div>
        </div>
        <div class="col-2">
            <div class="row align-items-end" style="height: 100%;">
                <div class="col" style="padding:0;">
                    <button class="btn btn-primary parform-controlform-control" asp-page-handler="Query">Query</button>
                    <a asp-page="/form" asp-route-keyword="Johnny" class="btn btn-info">導頁</a>
                </div>
            </div>
        </div>
    </div>
</form>
<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <td class="align-middle"><label asp-for="@employeeschema.Empno"></label></td>
                <td class="align-middle"><label asp-for="@employeeschema.Name"></label></td>
                <td class="align-middle"><label asp-for="@employeeschema.Sex"></label></td>
                <td class="align-middle"><label asp-for="@employeeschema.EnterDate"></label></td>
                <td class="align-middle"><label asp-for="@employeeschema.Email"></label></td>
                <td class="align-middle"><label asp-for="@employeeschema.PositionId"></label></td>
                <td class="align-middle"><label>操作</label></td>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < datalist.Count; i++)
            {
                var data = datalist[i];

                <tr>
                    <td class="align-middle">@data.Empno</td>
                    <td class="align-middle">@data.Name</td>
                    <td class="align-middle">@data.Sex</td>
                    <td class="align-middle">@data.EnterDate.ToShortDateString()</td>
                    <td class="align-middle">@data.Email</td>
                    <td class="align-middle">@data.Position</td>
                    <td class="align-middle">
                        <form method="post">
                            <button class="btn btn-danger parform-controlform-control" asp-page-handler="Update" asp-route-eid="@data.Eid">Update</button>
                            <button class="btn btn-danger parform-controlform-control" asp-page-handler="RollBack" asp-route-eid="@data.Eid">RollBack</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>



@*<div class="row">
        <div class="col-2"><label asp-for="@employeeschema.Empno"></label></div>
        <div class="col-2"><label asp-for="@employeeschema.Name"></label></div>
        <div class="col-2"><label asp-for="@employeeschema.Sex"></label></div>
        <div class="col-2"><label asp-for="@employeeschema.EnterDate"></label></div>
        <div class="col-2"><label asp-for="@employeeschema.Email"></label></div>
        <div class="col-2"><label asp-for="@employeeschema.PositionId"></label></div>
    </div>

    @for (int i = 0; i < datalist.Count; i++)
    {
        var data = datalist[i];

        <div class="row">
            <div class="col-2">@data.Empno</div>
            <div class="col-2">@data.Name</div>
            <div class="col-2">@data.Sex</div>
            <div class="col-2">@data.EnterDate.ToShortDateString()</div>
            <div class="col-2" style="text-overflow: ellipsis;overflow: hidden;">@data.Email</div>
            <div class="col-2">@data.Position</div>
        </div>
    }*@


@section Scripts
{
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}


    @*<script type="text/javascript">
                function popupwindow(url, title, w, h) {
          var left = (screen.width/2)-(w/2);
          var top = (screen.height/2)-(h/2);
          return window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
        }
            </script>*@
}
